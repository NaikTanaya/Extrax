$(document).ready(function() {
    var limit = 50;          // Number of records to fetch per request
    var offset = 0;          // Offset to fetch data from
    var hasMoreEntries = true; // Flag to check if more entries are available

    // Initialize DataTable with client-side processing enabled
    var t = $('#example').DataTable({
        paging: true,         // Enable pagination
        pageLength: limit,    // Show 50 records per page
        serverSide: false,    // Client-side pagination
        processing: true,     // Show processing indicator
        data: [],             // Start with empty data
        columns: [
            { data: 'EXECUTION_ID' },          // Data column 1
            { data: 'TECHNICAL_API_NAME' },    // Data column 2
            { data: 'MAJOR_VERSION' },         // Data column 3
            { data: 'APE_API_ID' },            // Data column 4
            { data: 'DEMAND_TYPE' }            // Data column 5
        ]
    });

    // Function to load data from the server
    function loadData() {
        if (!hasMoreEntries) return; // Exit if no more records are available

        $.ajax({
            url: '/yourAPIEndpoint', // Your API endpoint for fetching data
            type: 'GET',
            data: {
                limit: limit,  // Number of records to fetch
                offset: offset // Starting position for fetching
            },
            success: function(response) {
                hasMoreEntries = response.hasMoreEntries; // Check if more data is available

                // Add the new rows to the DataTable without clearing previous rows
                response.data.forEach(function(item) {
                    t.row.add(item);
                });

                // Draw the table with the new data
                t.draw(false);

                // Increase the offset for the next batch
                offset += limit;
            },
            error: function() {
                alert('Error fetching data');
            }
        });
    }

    // Load the initial batch of 50 records
    loadData();

    // Detect when user reaches the last page and fetch the next set of records
    $('#example').on('page.dt', function() {
        var info = t.page.info();

        // If the user is on the last page and there are more records to fetch
        if (info.page === info.pages - 1 && hasMoreEntries) {
            loadData(); // Fetch and append the next batch of records
        }
    });
});






$(document).ready(function() {
    var limit = 500;          // Number of records to fetch per request
    var offset = 0;           // Offset to fetch data from
    var hasMoreEntries = true; // Flag to check if more entries are available

    // Initialize DataTable with server-side processing enabled
    var t = $('#example').DataTable({
        paging: true,           // Enable pagination
        pageLength: limit,      // Show 500 records per page
        serverSide: true,       // Enable server-side processing
        processing: true,       // Show processing indicator
        ajax: function(data, callback, settings) {
            // Calculate the current offset based on the requested page
            var requestedOffset = data.start;

            // Check if data is already loaded for the requested page
            if (requestedOffset < offset) {
                // Slice the already loaded data to serve the request
                callback({
                    draw: data.draw,
                    recordsTotal: t.data().length, // Total records loaded
                    recordsFiltered: t.data().length, // Filtered records
                    data: t.rows().data().toArray().slice(requestedOffset, requestedOffset + limit)
                });
                return;
            }

            // If no more records are available, do not fetch
            if (!hasMoreEntries) {
                callback({
                    draw: data.draw,
                    recordsTotal: t.data().length, // Total records loaded
                    recordsFiltered: t.data().length, // Filtered records
                    data: []
                });
                return;
            }

            // Fetch the next batch of records from the server
            $.ajax({
                url: '/yourAPIEndpoint', // Your API endpoint for fetching data
                type: 'GET',
                data: {
                    limit: limit,   // Number of records to fetch
                    offset: offset  // Starting position for fetching
                },
                success: function(response) {
                    // Assume your API response includes total records count
                    var totalRecords = response.totalRecords; // Total records returned by your controller
                    hasMoreEntries = response.hasMoreEntries; // Check if more data is available

                    // Add the new rows to the DataTable without clearing previous rows
                    response.data.forEach(function(item) {
                        t.row.add(item);
                    });

                    // Update the total number of records loaded
                    offset += response.data.length;

                    // Call the callback to update the DataTable with new data
                    callback({
                        draw: data.draw,
                        recordsTotal: totalRecords, // Total number of records from the server
                        recordsFiltered: totalRecords, // Filtered records, usually the same as total
                        data: response.data
                    });
                },
                error: function() {
                    alert('Error fetching data');
                }
            });
        },
        columns: [
            { data: 'EXECUTION_ID' },          // Data column 1
            { data: 'TECHNICAL_API_NAME' },    // Data column 2
            { data: 'MAJOR_VERSION' },         // Data column 3
            { data: 'APE_API_ID' },            // Data column 4
            { data: 'DEMAND_TYPE' }            // Data column 5
        ]
    });

    // Reset the offset when searching or changing the number of records per page
    $('#example').on('search.dt length.dt', function() {
        offset = 0;
        hasMoreEntries = true; // Reset the hasMoreEntries flag
    });
});





                

$(document).ready(function() {
    var limit = 50;          // Number of records to fetch per request
    var offset = 0;          // Page number offset (starts from 0)
    var hasMoreEntries = true; // Flag to check if more entries are available
    var isFetching = false;  // Prevent multiple fetches at the same time
    var totalRecords = 0;    // Variable to track total records available on the server

    // Initialize DataTable with client-side processing enabled
    var t = $('#example').DataTable({
        paging: true,         // Enable pagination
        pageLength: limit,    // Show 50 records per page
        serverSide: false,    // Client-side pagination
        processing: true,     // Show processing indicator
        data: [],             // Start with empty data
        columns: [
            { data: 'EXECUTION_ID' },          // Data column 1
            { data: 'TECHNICAL_API_NAME' },    // Data column 2
            { data: 'MAJOR_VERSION' },         // Data column 3
            { data: 'APE_API_ID' },            // Data column 4
            { data: 'DEMAND_TYPE' }            // Data column 5
        ]
    });

    // Function to load data from the server
    function loadData() {
        if (!hasMoreEntries || isFetching) return; // Exit if no more records or already fetching data

        isFetching = true;

        console.log("Fetching data with limit:", limit, "and offset (page number):", offset);

        $.ajax({
            url: '/yourAPIEndpoint', // Your API endpoint for fetching data
            type: 'GET',
            data: {
                limit: limit,  // Number of records to fetch (50)
                offset: offset // Current page number
            },
            success: function(response) {
                var fetchedRecords = response.data.length;

                // Assuming response.totalRecords holds the total records on the server
                if (totalRecords === 0) {
                    totalRecords = response.totalRecords; // Set the totalRecords from the server response
                }

                console.log("Total records available:", totalRecords);
                console.log("Records fetched in this batch:", fetchedRecords);
                console.log("Current page offset (before increment):", offset);

                // Add the new records to the DataTable
                if (fetchedRecords > 0) {
                    t.rows.add(response.data).draw(false); // Append new records and redraw without resetting pagination
                }

                // Increment the offset by 1 for the next page
                offset++;

                console.log("Updated page offset (after increment):", offset);

                // Check if we've loaded all the available records
                hasMoreEntries = offset * limit < totalRecords; // Update the flag based on totalRecords

                console.log("Has more entries:", hasMoreEntries);
            },
            error: function() {
                alert('Error fetching data');
            },
            complete: function() {
                isFetching = false; // Reset fetching flag after the request completes
            }
        });
    }

    // Load the initial batch of 50 records (for the first page)
    loadData();

    // Detect when the user reaches the last page and fetch the next set of records
    $('#example').on('page.dt', function() {
        var info = t.page.info(); // Get pagination information

        console.log("Page info:", info);

        // Check if the user is on the last page and if there are more records to fetch
        if (info.page === info.pages - 1 && hasMoreEntries) {
            loadData(); // Fetch the next batch of records (next page)
        }
    });

    // Reset offset when the table is redrawn or filtered
    $('#example').on('search.dt length.dt', function() {
        offset = 0; // Reset to the first page
        hasMoreEntries = true; // Reset to assume there are more entries
    });
});


