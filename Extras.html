$(document).ready(function() {
    var limit = 50;
    var offset = 0;
    var hasMoreEntries = true;
    
    // Initialize DataTable
    var t = $('#example').DataTable({
        paging: true,
        pageLength: limit, // Show 50 records per page
        serverSide: false  // Use client-side pagination for already loaded records
    });

    // Function to load data
    function loadData() {
        if (!hasMoreEntries) return; // Exit if there are no more records

        $.ajax({
            url: '/yourAPIEndpoint',
            type: 'GET',
            data: {
                limit: limit,
                offset: offset
            },
            success: function(response) {
                hasMoreEntries = response.hasMoreEntries;

                // Append new rows to the DataTable without clearing existing data
                response.data.forEach(function(item, index) {
                    t.row.add([
                        item.executionId,
                        item.technicalApiName,
                        item.majorVersion,
                        item.apeApiId,
                        item.demandType
                    ]).draw(false);  // false to prevent full re-draw, appends to the current rows
                });

                // Increase the offset for the next batch
                offset += limit;
            },
            error: function() {
                alert('Error fetching data');
            }
        });
    }

    // Load the initial batch of 50 records
    loadData();

    // Handle "Next" button click when on the last page
    $('#example_paginate').on('click', '.paginate_button.next', function() {
        var info = t.page.info();
        
        // Check if we're on the last page and more entries are available
        if (info.page === (info.pages - 1) && hasMoreEntries) {
            loadData();  // Fetch and append the next batch of records
        }
    });
});
