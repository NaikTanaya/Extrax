var limit = 50;  // Number of records per page
var offset = 0;  // Offset starts at 0

// Initialize the DataTable
var table = $('#dataTable').DataTable({
    serverSide: true,        // Enable server-side processing
    processing: true,        // Show processing indicator
    paging: true,            // Enable pagination in DataTables
    pageLength: limit,       // Set the page length to 50 records
    ajax: function(data, callback, settings) {
        // Perform the AJAX request to fetch data
        $.ajax({
            url: '/yourAPIEndpoint',  // Your API endpoint for data fetching
            type: 'GET',
            data: {
                limit: limit,        // Send limit (always 50)
                offset: offset       // Send the current offset
            },
            success: function(response) {
                console.log(response);

                // Clear existing data and replace with new data
                table.clear().rows.add(response.data).draw();  // Clear and add new data

                // Update pagination buttons based on server response
                updatePaginationButtons(response.hasMoreEntries);

                // Optional: If you need to pass additional information (like total records)
                callback({
                    draw: data.draw,                   // Draw count for DataTables
                    recordsTotal: response.totalRecords,  // Total records available
                    recordsFiltered: response.totalRecords,  // Total records after filtering
                    data: response.data                // The actual data returned by the server
                });
            },
            error: function() {
                alert('Error fetching data');
            }
        });
    },
    columns: [
        { data: 'EXECUTION_ID' },
        { data: 'TECHNICAL_API_NAME' },
        { data: 'MAJOR_VERSION' },
        { data: 'APE_API_ID' },
        { data: 'DEMAND_TYPE' },
        { data: 'ENVIRONMENT' },
        { data: 'PLATFORM' },
        { data: 'CLUSTER' },
        { data: 'REGION' },
        { data: 'TASK_START_DATE' },
        { data: 'EXECUTION_DATETIME' },
        { data: 'USER_NAME' },
        { data: 'TECH_LEAD_APPROVAL_STATUS' },
        { data: 'TECH_LEAD_APPROVED_BY' },
        { data: 'APPROVAL_STATUS' }
    ],
    language: {
        paginate: {
            previous: "Previous",   // Custom label for the "Previous" button
            next: "Next"            // Custom label for the "Next" button
        }
    }
});

// Function to update pagination buttons based on server response
function updatePaginationButtons(hasMoreEntries) {
    // Disable the 'Next' button if no more entries are available
    if (!hasMoreEntries) {
        $('.paginate_button.next').addClass('disabled');
    } else {
        $('.paginate_button.next').removeClass('disabled');
    }

    // Disable the 'Previous' button if we're at the start
    if (offset === 0) {
        $('.paginate_button.previous').addClass('disabled');
    } else {
        $('.paginate_button.previous').removeClass('disabled');
    }
}

// Trigger next set of records when user reaches the last page
$('#dataTable').on('page.dt', function () {
    var pageInfo = table.page.info();  // Get current page info

    // If the user is on the last page (they've reviewed all 50 records)
    if (pageInfo.page === pageInfo.pages - 1 && $('.paginate_button.next').hasClass('disabled') === false) {
        offset += limit;  // Move to the next offset
        table.ajax.reload();  // Reload the table with the new offset data
    }
});

// Initial data load
table.ajax.reload();
