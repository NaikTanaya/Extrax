var limit = 50;  // Number of records per page
var offset = 0;  // Offset starts at 0

// Initialize the DataTable
var table = $('#dataTable').DataTable({
    serverSide: true,        // Enable server-side processing
    processing: true,        // Show processing indicator
    paging: false,           // Disable default pagination, since we handle it manually
    ajax: function(data, callback, settings) {
        // Perform the AJAX request to fetch data
        $.ajax({
            url: '/yourAPIEndpoint',  // Your API endpoint for data fetching
            type: 'GET',
            data: {
                limit: limit,        // Send limit (always 50)
                offset: offset       // Send the current offset
            },
            success: function(response) {
                console.log(response);

                // Append new data to the DataTable without clearing it
                table.rows.add(response.data).draw();  // Appends new rows to the existing table data

                // Update pagination buttons based on server response
                updatePaginationButtons(response.hasMoreEntries);

                // Optional: If you need to pass additional information (like total records)
                callback({
                    draw: data.draw,
                    recordsTotal: response.totalRecords,     // Total records available
                    recordsFiltered: response.totalRecords,  // Total records filtered
                });
            },
            error: function() {
                alert('Error fetching data');
            }
        });
    },
    columns: [
        { data: 'EXECUTION_ID' },
        { data: 'TECHNICAL_API_NAME' },
        { data: 'MAJOR_VERSION' },
        { data: 'APE_API_ID' },
        { data: 'DEMAND_TYPE' },
        { data: 'ENVIRONMENT' },
        { data: 'PLATFORM' },
        { data: 'CLUSTER' },
        { data: 'REGION' },
        { data: 'TASK_START_DATE' },
        { data: 'EXECUTION_DATETIME' },
        { data: 'USER_NAME' },
        { data: 'TECH_LEAD_APPROVAL_STATUS' },
        { data: 'TECH_LEAD_APPROVED_BY' },
        { data: 'APPROVAL_STATUS' }
    ],
    language: {
        paginate: {
            previous: "Previous",   // Custom label for the "Previous" button
            next: "Next"            // Custom label for the "Next" button
        }
    }
});

// Function to update pagination buttons based on server response
function updatePaginationButtons(hasMoreEntries) {
    // Disable the 'Next' button if no more entries are available
    if (!hasMoreEntries) {
        $('.paginate_button.next').addClass('disabled');
    } else {
        $('.paginate_button.next').removeClass('disabled');
    }

    // Disable the 'Previous' button if we're at the start
    if (offset === 0) {
        $('.paginate_button.previous').addClass('disabled');
    } else {
        $('.paginate_button.previous').removeClass('disabled');
    }
}

// Handle the 'Next' button click event
$('.paginate_button.next').on('click', function() {
    if (!$(this).hasClass('disabled')) {
        offset += limit; // Increase offset to load the next set of records
        table.ajax.reload(null, false);  // Reload the DataTable without resetting the paging (keep current view)
    }
});

// Handle the 'Previous' button click event
$('.paginate_button.previous').on('click', function() {
    if (!$(this).hasClass('disabled') && offset > 0) {
        offset -= limit; // Decrease offset to load the previous set of records
        table.ajax.reload(null, false);  // Reload the DataTable without resetting the paging (keep current view)
    }
});

// Initial data load
table.ajax.reload(null, false);  // Initial load without resetting the table
