$(document).ready(function() {
    var limit = 50;          // Number of records to fetch per request
    var offset = 0;          // Offset to fetch data from
    var hasMoreEntries = true; // Flag to check if more entries are available

    // Initialize DataTable with client-side processing enabled
    var t = $('#example').DataTable({
        paging: true,         // Enable pagination
        pageLength: limit,    // Show 50 records per page
        serverSide: false,    // Client-side pagination
        processing: true,     // Show processing indicator
        data: [],             // Start with empty data
        columns: [
            { data: 'EXECUTION_ID' },          // Data column 1
            { data: 'TECHNICAL_API_NAME' },    // Data column 2
            { data: 'MAJOR_VERSION' },         // Data column 3
            { data: 'APE_API_ID' },            // Data column 4
            { data: 'DEMAND_TYPE' }            // Data column 5
        ]
    });

    // Function to load data from the server
    function loadData() {
        if (!hasMoreEntries) return; // Exit if no more records are available

        $.ajax({
            url: '/yourAPIEndpoint', // Your API endpoint for fetching data
            type: 'GET',
            data: {
                limit: limit,  // Number of records to fetch
                offset: offset // Starting position for fetching
            },
            success: function(response) {
                hasMoreEntries = response.hasMoreEntries; // Check if more data is available

                // Add the new rows to the DataTable without clearing previous rows
                response.data.forEach(function(item) {
                    t.row.add(item);
                });

                // Draw the table with the new data
                t.draw(false);

                // Increase the offset for the next batch
                offset += limit;
            },
            error: function() {
                alert('Error fetching data');
            }
        });
    }

    // Load the initial batch of 50 records
    loadData();

    // Detect when user reaches the last page and fetch the next set of records
    $('#example').on('page.dt', function() {
        var info = t.page.info();

        // If the user is on the last page and there are more records to fetch
        if (info.page === info.pages - 1 && hasMoreEntries) {
            loadData(); // Fetch and append the next batch of records
        }
    });
});






$(document).ready(function() {
    var limit = 500;          // Number of records to fetch per request
    var offset = 0;           // Offset to fetch data from
    var hasMoreEntries = true; // Flag to check if more entries are available

    // Initialize DataTable with server-side processing enabled
    var t = $('#example').DataTable({
        paging: true,           // Enable pagination
        pageLength: limit,      // Show 500 records per page
        serverSide: true,       // Enable server-side processing
        processing: true,       // Show processing indicator
        ajax: function(data, callback, settings) {
            // Calculate the current offset based on the requested page
            var requestedOffset = data.start;

            // Check if data is already loaded for the requested page
            if (requestedOffset < offset) {
                // Slice the already loaded data to serve the request
                callback({
                    draw: data.draw,
                    recordsTotal: t.data().length, // Total records loaded
                    recordsFiltered: t.data().length, // Filtered records
                    data: t.rows().data().toArray().slice(requestedOffset, requestedOffset + limit)
                });
                return;
            }

            // If no more records are available, do not fetch
            if (!hasMoreEntries) {
                callback({
                    draw: data.draw,
                    recordsTotal: t.data().length, // Total records loaded
                    recordsFiltered: t.data().length, // Filtered records
                    data: []
                });
                return;
            }

            // Fetch the next batch of records from the server
            $.ajax({
                url: '/yourAPIEndpoint', // Your API endpoint for fetching data
                type: 'GET',
                data: {
                    limit: limit,   // Number of records to fetch
                    offset: offset  // Starting position for fetching
                },
                success: function(response) {
                    // Assume your API response includes total records count
                    var totalRecords = response.totalRecords; // Total records returned by your controller
                    hasMoreEntries = response.hasMoreEntries; // Check if more data is available

                    // Add the new rows to the DataTable without clearing previous rows
                    response.data.forEach(function(item) {
                        t.row.add(item);
                    });

                    // Update the total number of records loaded
                    offset += response.data.length;

                    // Call the callback to update the DataTable with new data
                    callback({
                        draw: data.draw,
                        recordsTotal: totalRecords, // Total number of records from the server
                        recordsFiltered: totalRecords, // Filtered records, usually the same as total
                        data: response.data
                    });
                },
                error: function() {
                    alert('Error fetching data');
                }
            });
        },
        columns: [
            { data: 'EXECUTION_ID' },          // Data column 1
            { data: 'TECHNICAL_API_NAME' },    // Data column 2
            { data: 'MAJOR_VERSION' },         // Data column 3
            { data: 'APE_API_ID' },            // Data column 4
            { data: 'DEMAND_TYPE' }            // Data column 5
        ]
    });

    // Reset the offset when searching or changing the number of records per page
    $('#example').on('search.dt length.dt', function() {
        offset = 0;
        hasMoreEntries = true; // Reset the hasMoreEntries flag
    });
});





                

$(document).ready(function() {
    var limit = 50;           // Number of records to fetch per request
    var offset = 0;           // Offset to start fetching data from
    var loadedData = [];      // Array to hold the currently loaded data
    var totalRecords = 0;     // Total records count
    var hasMoreEntries = true; // Flag to determine if more entries exist on the server

    // Initialize the DataTable
    var t = $('#example').DataTable({
        paging: true,          // Enable pagination
        pageLength: limit,     // Show 50 records per page
        serverSide: false,     // Disable server-side processing (we manage batches manually)
        processing: true,      // Show processing indicator
        data: loadedData,      // Use the loaded data array as the data source
        columns: [
            { data: 'EXECUTION_ID' },       // Column 1
            { data: 'TECHNICAL_API_NAME' }, // Column 2
            { data: 'MAJOR_VERSION' },      // Column 3
            { data: 'APE_API_ID' },         // Column 4
            { data: 'DEMAND_TYPE' }         // Column 5
        ],
        drawCallback: function(settings) {
            // Check if the last page is reached
            var info = t.page.info();
            if (info.page === info.pages - 1 && hasMoreEntries) {
                // If the user is on the last page, trigger data fetching for the next set
                fetchNewData(function() {
                    // After fetching new data, stay on the same page
                    t.page(info.page).draw(false);
                });
            }
        }
    });

    // Function to fetch new data from the server
    function fetchNewData(callback) {
        if (!hasMoreEntries) {
            callback(); // No more data to fetch
            return;
        }

        $.ajax({
            url: '/execution-status', // Your server API
            type: 'GET',
            data: {
                limit: limit,   // Number of records to fetch
                offset: offset  // Starting position for the current page
            },
            success: function(response) {
                var newData = response.data;
                totalRecords = response.totalRecords; // Update total records count
                hasMoreEntries = response.hasMoreEntries; // Check if more records exist

                // Increment the offset for the next fetch
                offset += newData.length;

                // Add new data to the already loaded data
                loadedData = loadedData.concat(newData);

                // Reload DataTable with the updated data
                t.clear().rows.add(loadedData).draw();

                // Update DataTables with the total number of records
                t.settings()[0]._iRecordsTotal = totalRecords;
                t.settings()[0]._iRecordsDisplay = totalRecords;

                // Call the callback once data is loaded
                callback();
            },
            error: function() {
                alert('Error fetching data');
            }
        });
    }

    // Load the first set of data on page load
    fetchNewData(function() {
        t.draw();
    });

    // Handle next page clicks
    $('#example').on('page.dt', function() {
        var info = t.page.info();

        // Check if the user has reached the last page of the currently loaded data
        if (info.page === info.pages - 1 && hasMoreEntries) {
            // Fetch the next set of data when the user clicks "Next" on the last page
            fetchNewData(function() {
                // After fetching new data, stay on the same page
                t.page(info.page).draw(false);
            });
        }
    });
});


